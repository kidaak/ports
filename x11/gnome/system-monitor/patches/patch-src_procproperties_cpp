$OpenBSD: ports/x11/gnome/system-monitor/patches/patch-src_procproperties_cpp,v 1.3 2012/03/30 10:06:23 ajacoutot Exp $

From 94be681c159b56ad42afb13c3e18d59be4422558 Mon Sep 17 00:00:00 2001
From: Antoine Jacoutot <ajacoutot@gnome.org>
Date: Fri, 30 Mar 2012 08:55:08 +0000
Subject: procproperties: unbreak on OpenBSD

--- src/procproperties.cpp.orig	Mon Mar 19 19:40:26 2012
+++ src/procproperties.cpp	Fri Mar 30 10:46:41 2012
@@ -24,7 +24,12 @@
 #include <glibtop/procmem.h>
 #include <glibtop/procmap.h>
 #include <glibtop/procstate.h>
+#if defined (__linux__)
 #include <asm/param.h>
+#elif defined (__OpenBSD__)
+#include <sys/param.h>
+#include <sys/sysctl.h>
+#endif
 
 #include "procman.h"
 #include "procproperties.h"
@@ -108,6 +113,18 @@ fill_proc_properties (GtkWidget *tree, ProcInfo *info)
     GtkListStore *store;
 
     get_process_memory_info(info);
+
+#if defined (__OpenBSD__)
+    struct clockinfo cinf;
+    size_t size = sizeof (cinf);
+    int HZ;
+    int mib[] = { CTL_KERN, KERN_CLOCKRATE };
+
+    if (sysctl (mib, nitems(mib), &cinf, &size, NULL, 0) == -1)
+        HZ = 100;
+    else
+        HZ = cinf.hz;
+#endif
 
     proc_arg proc_props[] = {
         { N_("Process Name"), g_strdup_printf("%s", info->name)},
